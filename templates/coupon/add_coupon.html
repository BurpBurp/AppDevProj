<!-- Darwin's Stuff -->
{% extends 'base.html' %}
{% set active_page = "admin" %}
{% set subpage = "coupons" %}

{% block head %}
<title>Manage Users</title>
{% endblock %}

<script>
{% block headscript %}
$(document).ready(function() {
    $("#add_code").click(function(){
        new_id = $(".code-input").length
        var div = $("<div></div>").addClass("form-floating col-md-12 code-input")
        var input = $(`<input id='codes-${new_id}' name='codes-${new_id}' placeholder='a' required type='text' value></input>`).addClass("form-control form-control-lg")
        var label = $(`<label for='codes-${new_id}'>Code</label>`)
        div.append(input)
        div.append(label)
        $(this).parent().append(div)
    })

    $("#remove_code").click(function(){
        console.log("REMOVING CODE")
        new_id = $(".code-input").length
        if (new_id > 1) {
            $(this).parent().children(".code-input:last").remove()
        }
        
    })

    $("#coupon_type").change(function() {
        console.log("CHANGE")
        selected_value = $(this).children("option:selected").val()
        console.log(selected_value)
        if (selected_value == "percentage") {
            console.log("PERCENTAGE CHANGE")
            $("#coupon_discount_label").text("Percentage Off")
            $("#coupon_discount").attr({
                "max" : 100,
            })
        } else {
            console.log("Amount CHANGE")
            $("#coupon_discount_label").text("Amount Off")
            $("#coupon_discount").removeAttr("max")
        }
    })
})
{% endblock %}
</script>

{% block main %}
<div class="container justify-content-center min-vh-100 d-flex align-items-center">
    <div class="container w-auto">
        <div class="row justify-content-center">
            <form action="#" method="post" class="col-md-6 shadow-lg rounded p-5" novalidate>
                {{ form.hidden_tag() }}
                <fieldset class="form-group row g-3">
                    <legend>Add Coupon</legend>

                    <div class="form-floating col-md-12">
                        {% if form.name.errors %}
                            {{ form.name(class="form-control form-control-lg is-invalid",placeholder="a") }}
                            <div class="invalid-feedback">
                                {% for error in form.name.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.name(class="form-control form-control-lg",placeholder="a") }}
                        {% endif %}
                        {{ form.name.label }}
                    </div>
                    
                    <div class="form-floating">
                        {{ form.coupon_type(class="form-select form-control-lg") }}
                        {{ form.coupon_type.label }}
                    </div>

                    <div class="form-floating col-md-12">
                        {% if form.coupon_discount.errors %}
                            {{ form.coupon_discount(class="form-control form-control-lg is-invalid",placeholder="a") }}
                            <div class="invalid-feedback">
                                {% for error in form.coupon_discount.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.coupon_discount(class="form-control form-control-lg",placeholder="a") }}
                        {% endif %}
                        {{ form.coupon_discount.label(id="coupon_discount_label") }}
                    </div>
                    <fieldset class="form-group row g-3 px-0">
                        <legend>Coupon Codes</legend>
                        <button class="btn btn-secondary w-auto col-auto ms-2" type="button" id="add_code"><i class="fa fa-plus"></i> Add Code</button>
                        <button class="btn btn-secondary w-auto col-auto ms-2" type="button" id="remove_code"><i class="fa fa-minus"></i> Remove Code </button>
                        {% for nested in form.codes %}
                            <div class="form-floating col-md-12 code-input">
                                {% if nested.errors %}
                                    {{ nested(class="form-control form-control-lg is-invalid",placeholder="a") }}
                                    <div class="invalid-feedback">
                                        {% for error in nested.errors %}
                                            <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    {{ nested(class="form-control form-control-lg",placeholder="a") }}
                                {% endif %}
                                {{ nested.label }}
                            </div>
                        {% endfor %}
                    </fieldset>
                    
                </fieldset>
                <fieldset class="row mt-3 justify-content-end g-3 px-0">
                    <div class="col-12"><button type="submit" class="btn btn-primary float-end">Add Coupon</button></div>
                </fieldset>
            </form>
        </div>
    </div>
</div>
{% endblock %}
